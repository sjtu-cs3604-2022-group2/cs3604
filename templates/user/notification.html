{% extends 'base.html'%} {% block head %}

<title>Notifications</title>
{{super()}}
<link
  rel="stylesheet"
  type="text/css"
  href="{{ url_for('static', filename='css/user/notification.css')}}"
/>

{%endblock head%} {%block content%}

<table class="table table-hover notice_table">
  <caption>
    <h1>通知</h1>
  </caption>
  <thead>
    <tr>
      <!-- <th>状态</th>
        <th>来自</th>
        <th>动作</th>
        <th>详情</th>
        <th>时间</th> -->
    </tr>
  </thead>
  <tbody>
    {%set states=["未读","已读"]%} {%set actions=["点赞","评论"]%} {%set
    objects=["帖子","回帖"]%} {%for notice in notices%}
    <tr class="state{{notice.state}}">
      <td class="state">{{states[notice.state]}}</td>
      <td class="from_user">
        <span>{{User.query.get(notice.action_id).username}}</span>
      </td>
      <td class="action">
        <span>{{actions[notice.action]}}</span><span>了你的</span
        ><sapn>{{objects[notice.object]}}</sapn>
      </td>
      <td class="object_detail">
        {%if notice.object == 0 %}
        <a href="{{notice.link}}">{{notice.post.title | safe}}</a>
        {%elif notice.object == 1 %}
        <a href="{{notice.link}}" class="comment_body">{{notice.body |safe }}</a>
        {%endif%}
      </td>
      <td class="timestamp">{{notice.timestamp}}</td>
    </tr>
    {%endfor%}
  </tbody>&nbsp;
</table>

{%endblock content%}

{%block scripts%}
{{super()}}
<script>
  $(window).on('load',function(){
    var lst=$('.comment_body');
    var re1=new RegExp("</p>","g");
    var re=new RegExp("<.+?>","g");
    var re2=new RegExp("&lt;.+?&gt;","g");
    for(var i=0;i<lst.length;++i){
      var element=lst[i];
      var str=element.innerHTML;
      var newstr=str.replace(re1,"&nbsp;&nbsp;&nbsp;");
      newstr=newstr.replace(re,'');
      newstr=newstr.replace(re2,'');
      if(newstr.length>40){
        newstr=newstr.substring(0,40);
      }
      element.innerHTML=newstr;
      
    }
  })
  function filter(str){
    var re1=new RegExp("</p>","g");
    var re=new RegExp("<.+?>","g");
      var newstr=str.replace(re1,"&nbsp;&nbsp;&nbsp;");
      newstr=newstr.replace(re,'');
      if(newstr.length>40){
        newstr=newstr.substring(0,40);
      }
      return newstr;


  }
</script>
{%endblock scripts%}
